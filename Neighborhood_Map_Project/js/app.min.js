var script=document.createElement("script");$(script).attr("async","async");$(script).attr("defer","defer");script.onerror=function(a){console.log("Maps Api Failed to Load!")};script.onload=function(a){console.log("Maps Api Loaded Successfully!")};script.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9lp_4MnBzuh-R8-L8f8yQ15QKgHeRMnI&v=3&callback=initMap";document.body.appendChild(script);var map,infowindow;var markers=[];var query=ko.observable("");function Model(){var a=[{title:"National Gallery London",location:{lat:51.508926,lng:-0.128285},streetAddress:"Trafalgar Square",cityAddress:"London, WC2N 5DN",id:"nav0",visible:true,isMarker:true},{title:"National Portrait Gallery",location:{lat:51.509422,lng:-0.128122},streetAddress:"St. Martin's Pl",cityAddress:"London WC2H 0HE",id:"nav0",visible:true,isMarker:true},{title:"Tate Modern",location:{lat:51.507594,lng:-0.099357},streetAddress:"Bankside",cityAddress:"London SE1 9TG",id:"nav0",visible:true,isMarker:true},{title:"Saatchi Gallery",location:{lat:51.490696,lng:-0.158716},streetAddress:"Duke Of York's HQ, King's Rd",cityAddress:"London SW3 4RY",id:"nav0",visible:true,isMarker:true},{title:"Natural History Museum",location:{lat:51.496714,lng:-0.176372},streetAddress:"Cromwell Rd",cityAddress:"London SW7 5BD",id:"nav0",visible:true,isMarker:true},{title:"Tate Britain",location:{lat:51.491062,lng:-0.127788},streetAddress:"Millbank, Westminster",cityAddress:"London SW1P 4RG",id:"nav0",visible:true,isMarker:true}];return a}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:51.508926,lng:-0.128285},zoom:13});var h=Model();var l=new google.maps.InfoWindow();var a=new google.maps.LatLngBounds();for(var e=0;e<h.length;e++){var f=h[e].location;var k=h[e].title;var j=h[e].streetAddress;var c=h[e].cityAddress;var b=h[e].visible;var d=new google.maps.Marker({map:map,position:f,title:k,animation:google.maps.Animation.DROP,visible:b,id:e});d.addListener("click",function(){populateInfoWindow(this,l,j,c);toggleBounce(this)});d.street=j;d.city=c;markers.push(d);a.extend(markers[e].position)}map.fitBounds(a);var g=function(i){this.position=ko.observable(i.position);this.title=ko.observable(i.title);this.visibility=ko.observable(i.visible);this.clickable=function(){populateInfoWindow(i,l);toggleBounce(i)}};var m=function(){var i=this;this.recenter=function(){return map.fitBounds(a)};function n(){console.log();var p=[];for(var o=0;o<markers.length;o++){p[o]=new g(markers[o])}return p}this.setMarker=function(o){o.clickable()};this.searchResults=ko.computed(function(){var o=query();return n().filter(function(p){return p.title().toLowerCase().indexOf(o)>=0})});this.searchMarkers=ko.computed(function(){var o=query();return markers.filter(function(p){if(p.title.toLowerCase().indexOf(o)!==0){p.setMap(null)}else{p.setMap(map)}return p.title.toLowerCase().indexOf(o)>=0})})};ko.applyBindings(new m())}function populateInfoWindow(a,c){if(c.marker!=a){c.marker=a;var b=getFlickerImage(a);c.setContent('<div class="markers marker0'+a.id+"\"><li class'markerLiItem'><img src='http://farm"+b[0].farm+".static.flickr.com/"+b[0].server+"/"+b[0].id+"_"+b[0].secret+"_m.jpg' alt=''></li><li class'markerLiItem'><img src='http://farm"+b[1].farm+".static.flickr.com/"+b[1].server+"/"+b[1].id+"_"+b[1].secret+"_m.jpg' alt=''></li><li class'markerLiItem'><img src='http://farm"+b[2].farm+".static.flickr.com/"+b[2].server+"/"+b[2].id+"_"+b[2].secret+"_m.jpg' alt=''></li><li class'markerLiItem'><h3>"+a.title+"</h3><p>"+a.street+"</p><p>"+a.city+"</p></li></div>");map.setZoom(15);map.setCenter(a.getPosition());c.open(map,a);c.addListener("closeclick",function(){a.setAnimation(null);c.marker=(null)});$(".recenter").css("display","block")}}function toggleBounce(a){for(var b=0;b<markers.length;b++){markers[b].setAnimation(null)}if(a.getAnimation()!==null){a.setAnimation(null)}else{a.setAnimation(google.maps.Animation.BOUNCE)}}function getFlickerImage(b){var c=this;var d=f(b);var h;a(d);function f(j){var k=j.title;k=k.replace(/\s+/g,"+");var i="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=fd46fabfe3102f771ee0e03a437febf4&text="+k+"&page=1&format=json&jsoncallback=?";return i}var e=function(i){this.farm=i.farm;this.server=i.server;this.id=i.id;this.secret=i.secret};var g=function(i){this.myObject=i};function a(j){jqXHR=$.getJSON(j,i).done(function(){console.log("getJSON request succeeded!")}).fail(function(k,m,l){console.log("getJSON request failed! "+m)}).always(function(){console.log("getJSON request ended!")});function i(l){function k(n){var m=[];$.each(n.photos.photo,function(o,p){if(o<3){m[o]=new e(p.farm)}});h=new g(m);return h.myObject}return k(l)}}return jqXHR.responseJSON};